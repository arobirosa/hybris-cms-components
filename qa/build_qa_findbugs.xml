<project name="ant_qa_findbugs" default="findbugs" basedir=".">
	<property name="dir_findbugs_home" value="${dir_qa}/spotbugs-3.1.12"/>
	<property name="dir_findbugs_donwload_url" value="https://repo.maven.apache.org/maven2/com/github/spotbugs/spotbugs/3.1.12/spotbugs-3.1.12.zip"/>
	<property name="dir_findbugs_donwload_file" value="${dir_qa}/spotbugs.zip"/>
	
	<target name="findbugs" depends="findbugs.install, build" description="Runs Spotbugs">		
		 <taskdef resource="edu/umd/cs/findbugs/anttask/tasks.properties">
				<classpath>
					<fileset dir="${dir_findbugs_home}/lib/">
						<include name="*.jar"/>
					</fileset>
				</classpath>
		</taskdef>
		<!-- Any violation must break the build -->				
		<spotbugs home="${dir_findbugs_home}"
			  reportLevel="low"
              output="html"
              outputFile="${dir_qa_reports}/findbugs_report.html"
              stylesheet="plain.xsl"
              effort="max"
              failOnError="true"
              errorProperty="findbugsFailure"
              excludeFilter="${dir_qa}/findbugs_excluded_classes.xml"
              warningsProperty="findbugsFailure">
			<sourcePath path="${basedir}/src/java" />
			<fileset refid="fileset_bin"/>
			<auxClasspath>
                <fileset refid="fileset_hybris_bin" />
            </auxClasspath>
		</spotbugs>
		<!-- Fail on any warning -->
		<fail if="findbugsFailure" />
	</target>
	
	 <target name="findbugs.check.installation" >
        <available property="findbugs.available"
            file="${dir_findbugs_home}"
            type="dir"/>
    </target>
	
	
	<target name="findbugs.install" description="Downloads and installs Findbugs"
        unless="findbugs.available"
		depends="findbugs.check.installation">
		<get src="${dir_findbugs_donwload_url}" 
			dest="${dir_findbugs_donwload_file}" 
			verbose="true"
			usetimestamp="true"/>
		<unzip src="${dir_findbugs_donwload_file}" dest="${dir_qa}" failOnEmptyArchive="true" />
		<delete file="${dir_findbugs_donwload_file}"/>
	</target>
</project>
